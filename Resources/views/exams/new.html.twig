{% extends "@IServCore/page.html.twig" %}

{% block page_title %}{{ 'Neue Prüfung anlegen'|trans }}{% endblock %}

{% block page_content %}
    <div class="content">
        <a href="{{ path('sportabzeichen_exams_dashboard') }}" class="btn btn-default mb-3">
            {{ icon('arrow-left') }} {{ 'Zurück'|trans }}
        </a>

        <h2>{{ 'Neue Prüfung anlegen'|trans }}</h2>

        {# --- HIER WAR DER FEHLER: Wir nutzen jetzt Flash-Messages --- #}
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label == 'error' ? 'danger' : label }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}

        <form method="post">
            <div class="mb-3">
                <label class="form-label" for="exam_name">{{ 'Bezeichnung (optional)'|trans }}</label>
                <input type="text" id="exam_name" name="exam_name" class="form-control" placeholder="z.B. Sommerfest">
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label" for="exam_year">{{ 'Jahr'|trans }} *</label>
                    <input type="number" id="exam_year" name="exam_year" class="form-control" required value="{{ 'now'|date('Y') }}">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label" for="exam_date">{{ 'Datum'|trans }}</label>
                    <input type="date" id="exam_date" name="exam_date" class="form-control">
                </div>
            </div>

            <hr />

            <div class="mb-3">
                <label class="form-label" for="classes">{{ 'Teilnehmer direkt importieren (Mehrfachauswahl möglich)'|trans }}</label>
                
                {# 
                   ACHTUNG: 
                   1. name="classes[]" -> Damit PHP ein Array bekommt
                   2. multiple="multiple" -> Erlaubt Mehrfachauswahl
                   3. class="form-control select2" -> Aktiviert das IServ Such-Feature
                #}
                <select name="classes[]" id="classes" class="form-control select2" multiple="multiple" data-placeholder="{{ 'Bitte wählen (z.B. 5a, 6b)...'|trans }}">
                    {% for c in classes %}
                        <option value="{{ c }}">{{ c }}</option>
                    {% endfor %}
                </select>
                
                <small class="text-muted d-block mt-1">
                    {{ 'Klicke in das Feld, um Klassen zu suchen und hinzuzufügen.'|trans }}
                </small>
            </div>

            <button type="submit" class="btn btn-primary">{{ 'Speichern'|trans }}</button>
        </form>
    </div>
{% endblock %}