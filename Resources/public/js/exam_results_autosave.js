(()=>{"use strict";IServ.SportabzeichenAutosave=IServ.register({init:function(){const e=document.querySelectorAll("[data-save]");e.length?(console.log("[Sportabzeichen] Autosave aktiviert für",e.length,"Felder"),e.forEach(e=>{e.addEventListener("change",()=>function(e){const t=e.dataset.epId,s=e.dataset.type,n=e.dataset.disciplineId||("SELECT"===e.tagName?e.value:null),a="leistung"===s?e.value:null;if(!t||!n&&"discipline"!==s)return void console.warn("[Sportabzeichen] Ungültige Daten:",t,n);const r={ep_id:t,discipline_id:n,leistung:a};e.classList.remove("saved","error"),e.classList.add("saving"),fetch(IServ.routes.sportabzeichen_exam_result_save,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":IServ.csrfToken.sportabzeichen_result_save},body:JSON.stringify(r)}).then(t=>{if(!t.ok)throw new Error("HTTP "+t.status);e.classList.remove("saving"),e.classList.add("saved"),setTimeout(()=>e.classList.remove("saved"),1200)}).catch(t=>{console.error("[Sportabzeichen] Fehler beim Speichern:",t),e.classList.remove("saving"),e.classList.add("error")})}(e)),e.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),e.blur())})})):console.warn("[Sportabzeichen] Keine Autosave-Felder gefunden.")}}),IServ.SportabzeichenAutosave})();